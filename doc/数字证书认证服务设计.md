# 数字证书服务设计

- [数字证书服务设计](#%E6%95%B0%E5%AD%97%E8%AF%81%E4%B9%A6%E6%9C%8D%E5%8A%A1%E8%AE%BE%E8%AE%A1)
  - [1 参考资料](#1-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99)
  - [2 术语](#2-%E6%9C%AF%E8%AF%AD)
  - [3 总体设计原则](#3-%E6%80%BB%E4%BD%93%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99)
  - [4 要求](#4-%E8%A6%81%E6%B1%82)
    - [4.1 功能要求](#41-%E5%8A%9F%E8%83%BD%E8%A6%81%E6%B1%82)
    - [4.2 性能要求](#42-%E6%80%A7%E8%83%BD%E8%A6%81%E6%B1%82)
    - [4.3 管理员配置要求](#43-%E7%AE%A1%E7%90%86%E5%91%98%E9%85%8D%E7%BD%AE%E8%A6%81%E6%B1%82)
    - [4.4 初始化要求](#44-%E5%88%9D%E5%A7%8B%E5%8C%96%E8%A6%81%E6%B1%82)
    - [4.5 密钥安全要求](#45-%E5%AF%86%E9%92%A5%E5%AE%89%E5%85%A8%E8%A6%81%E6%B1%82)
  - [5 各个模块功能](#5-%E5%90%84%E4%B8%AA%E6%A8%A1%E5%9D%97%E5%8A%9F%E8%83%BD)
    - [5.1 用户注册管理系统](#51-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F)
    - [5.2 证书/证书撤销列表的生成签发系统](#52-%E8%AF%81%E4%B9%A6%E8%AF%81%E4%B9%A6%E6%92%A4%E9%94%80%E5%88%97%E8%A1%A8%E7%9A%84%E7%94%9F%E6%88%90%E7%AD%BE%E5%8F%91%E7%B3%BB%E7%BB%9F)
    - [5.3 证书/证书撤销列表的存储发布系统](#53-%E8%AF%81%E4%B9%A6%E8%AF%81%E4%B9%A6%E6%92%A4%E9%94%80%E5%88%97%E8%A1%A8%E7%9A%84%E5%AD%98%E5%82%A8%E5%8F%91%E5%B8%83%E7%B3%BB%E7%BB%9F)
      - [5.3.1 证书/证书撤销列表的存储发布系统功能](#531-%E8%AF%81%E4%B9%A6%E8%AF%81%E4%B9%A6%E6%92%A4%E9%94%80%E5%88%97%E8%A1%A8%E7%9A%84%E5%AD%98%E5%82%A8%E5%8F%91%E5%B8%83%E7%B3%BB%E7%BB%9F%E5%8A%9F%E8%83%BD)
      - [5.3.2 证书/证书撤销列表的存储发布系统结构](#532-%E8%AF%81%E4%B9%A6%E8%AF%81%E4%B9%A6%E6%92%A4%E9%94%80%E5%88%97%E8%A1%A8%E7%9A%84%E5%AD%98%E5%82%A8%E5%8F%91%E5%B8%83%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84)
    - [5.4 证书状态查询系统](#54-%E8%AF%81%E4%B9%A6%E7%8A%B6%E6%80%81%E6%9F%A5%E8%AF%A2%E7%B3%BB%E7%BB%9F)
      - [5.4.1 证书状态查询系统功能](#541-%E8%AF%81%E4%B9%A6%E7%8A%B6%E6%80%81%E6%9F%A5%E8%AF%A2%E7%B3%BB%E7%BB%9F%E5%8A%9F%E8%83%BD)
      - [5.4.2 证书状态查询系统结构](#542-%E8%AF%81%E4%B9%A6%E7%8A%B6%E6%80%81%E6%9F%A5%E8%AF%A2%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84)
    - [5.5 证书管理系统](#55-%E8%AF%81%E4%B9%A6%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F)

## 1 参考资料

- GMT 0034-2014 基于SM2密码算法的证书认证系统密码及其相关安全技术规范
- GMT 0016-2012 智能密码钥匙密码应用接口规范

## 2 术语

| 术语 | 定义 | 缩写 | 详细信息 |
| --- | --- | --- | --- |
| 密钥管理中心 | key management center | KMC | - |
| 证书认证机构 | certificate authority | CA | 对数字证书进行全生命周期管理的实体，也称为电子认证服务机构或认证中心 |
| 证书注册机构 | registration authority | RA | 受理数字证书的申请、更新、恢复和注销等业务的实体 |

## 3 总体设计原则

- 密码运算必须在密码设备完成

## 4 要求

### 4.1 功能要求

- CA 提供两种审核模式：
  - 人工审核
  - 自动审核

### 4.2 性能要求

- CA 系统的性能要求包括：
  - 系统对用户接口采用标准的 HTTP/HTTPS/LDAP/OCSP 协议，确保各种用户能够使用本系统服务
  - 各模块的功能可通过配置文件进行控制，系统可根据不同的需求进行设置
  - 某一功能模块可有多个实例，且多个实例可允许在一台或多台计算机上

### 4.3 管理员配置要求

CA 应设置下列管理和操作人员

| 管理员类型 | 描述 | 权限 |
| --- | --- | --- |
| CA 超级管理员 | 负责 CA 系统的策略设置，设置各子系统的业务管理员并对其管理的业务范围进行授权 | 增删改 CA 业务管理员账号 |
| CA 业务管理员 | 负责 CA 系统的某个子系统的业务管理，设置本子系统的业务操作员并对其的操作权限进行授权 | 增删改 CA 业务操作员账号 |
| CA 业务操作员 | 按其权限进行具体的业务操作 | 管理证书模板、配置证书策略、对系统进行配置，如配置主机加密服务器参数、目录服务器、CA 系统参数、RA 系统参数等；增删改 RA 业务管理员和 RA 审计员账号 |
| CA 审计管理员 | 负责删除审计员并进行管理 | 增删改 CA 审计员账号 |
| CA 审计员 | 负责对涉及系统安全的事件和各类管理和操作人员的行为进行审计和监督 | 查询 CA 系统日志、查询审计 CA 操作记录 |
| RA 业务管理员 | - | 增删改 RA 业务操作员账号 |
| RA 业务操作员 | - | 对证书申请的录入；对证书更新申请、密钥恢复申请的录入；审核证书申请、撤销审核；证书的下载、制作；证书查询；审核证书更新请求和密钥恢复请求；录入和审核工作不能由同一人兼任 |
| RA 审计员 | - | 查询 RA 系统日志、查询审计 RA 操作记录 |
| 安全管理员 | - | 全面负责系统的安全工作 |

- 暂时只需要一个超级管理员完成所有功能
- 暂时只支持使用用户名和密码登录

### 4.4 初始化要求

CA 的初始化过程必须完成下列工作：

- 产生本 CA 的机构密钥对
- CA 的签名密钥进行自签名
- CA 签发 CA 服务器证书

### 4.5 密钥安全要求

- 密钥的生成和使用必须在硬件密码设备完成
- 存在于硬件密码设备之外的所有密钥必须加密
- CA 系统的根密钥由硬件密码设备生成并存档在密码设备中

## 5 各个模块功能

### 5.1 用户注册管理系统

用户注册管理系统功能包括：

- 用户信息的录入：
  - 用户申请信息包括签发证书所需的信息，还包括用于验证用户身份的信息，这些信息存放在用户注册管理系统的数据库
  - 用户注册管理系统应能够批量处理外部系统生成的、以电子文档方式存储的用户信息(可选)
- 用户信息的审核：提取用户的申请信息，审核用户的真实身份
  - 审核通过后，将证书签发所需信息提交给签发系统
- 具有并行处理能力

### 5.2 证书/证书撤销列表的生成签发系统

证书/证书撤销列表的生成签发系统功能包括：

- 证书生成与签发：
  - 根据接收的请求信息，从数据库读取用户信息进行核对，根据拟签发的证书类型向密钥管理中心申请加密密钥对，生成用户的签名证书和加密证书
  - 签发的证书和及加密证书的私钥通过证书管理系统下传给申请者
  - 将签发完成的证书发布到目录服务器和数据库
  - 根据系统的配置和管理策略，不同种类或用途的证书可采用不同的签名密钥
- 证书更新：
  - 更新 CA 证书及用户证书
- 证书撤销列表生成与签发：
  - 接收注销信息，验证注销信息中的签名，然后签发 CRL，将签发后的注销列表发布到数据库或目录服务器
  - 签发证书撤销列表的签名密钥可与签发证书的签名密钥相同或不同
- 安全管理：
  - 配置不同的密码设备
  - 配置不同的证书模板：
    - 不同的证书种类由不同的证书模板确定
    - 证书模板包括相应种类证书的基本项和证书的扩展项
  - 配置证书撤销列表发布策略：包括自动/人工发布模式选择、发布时间间隔
  - 配置数据库系统：数据源的选择，数据库连接的用户名和口令设置
- 具有并行处理能力

### 5.3 证书/证书撤销列表的存储发布系统

#### 5.3.1 证书/证书撤销列表的存储发布系统功能

- 证书/证书撤销列表存储
- 证书/证书撤销列表发布
- 数据一致性检验：对数据库和目录服务器中的数据进行一致性检验

#### 5.3.2 证书/证书撤销列表的存储发布系统结构

- 证书的存储和发布必须采用数据库和/或目录服务器
- 数据库：存放证书、CRL、用户的其他信息

### 5.4 证书状态查询系统

#### 5.4.1 证书状态查询系统功能

- 为用户及应用系统提供证书状态查询服务
- 查询方式可采用：
  - CRL 查询：用户或应用系统利用证书中标识的 CRL 地址，查询并下载 CRL 到本地，进行证书状态的检验
  - 在线证书状态查询：用户或应用系统利用 OCSP 协议，在线实时查询证书的状态，查询结果经过签名后返回给请求者，进行证书状态的检验

#### 5.4.2 证书状态查询系统结构

- 证书状态数据库/OCSP 服务器：接收用户及应用系统的证书状态查询请求，根据请求信息中的证书序列号，从证书状态数据库中查询证书的状态，返回查询结果给请求者
- 密码设备：验证请求信息中的签名，并对查询结果进行签名

### 5.5 证书管理系统

- 证书管理系统是证书认证系统的综合信息控制和调度服务系统。它接收用户的各种请求信息，并将请求信息提交给相应的子系统
- 证书管理系统由不同的处理模块组成，这些模块可采用分布式的结构，以增强系统处理能力